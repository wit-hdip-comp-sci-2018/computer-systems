

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-rc.10/css/uikit.min.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-rc.10/js/uikit.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-rc.10/js/uikit-icons.min.js"></script>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/railscasts.min.css"/>
    <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/java.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <style>
    

body {
  font-family: "Open Sans", "Helvetica", "Helvetica Neue",  "Arial", sans-serif;
  font-size:90%;
  color: black;
}

p {
  margin: 0.5em;
}

pre code {
  font-family: "Monaco";
  font-size: 100%;
}

img {
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
  margin:10px;
}

h1, h2, h3 {
  border-bottom:thin solid black;
  margin-bottom: 0.5em;
  margin-top: 1em;
}

h1 {
  font-style:italic;
  font-size:130%;
}

h2 {
  font-size:110%;
}

h3 {
  font-size:100%;
}



  </style>

  <body class="lab">

    
  <div class="uk-offcanvas-content">
    <div id="offcanvas-usage" uk-offcanvas>
      <div class="uk-offcanvas-bar">
        <button class="uk-offcanvas-close" type="button" uk-close></button>
        <ul class="uk-nav">
          
            
              <li>
                <a class="item" href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-00-open-day/book-1/index.html">
  <i class="fas fa-flask " style="color:#00BCD4"> </i>
Preparatory Lab
                </a>
              </li>
            
          
            
              <li>
                <a class="item" href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-00-open-day/book-2/index.html">
  <i class="fas fa-flask " style="color:#00BCD4"> </i>
Shell Scripting
                </a>
              </li>
            
          
            
              <li>
                <a class="item" href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-00-open-day/book-3/index.html">
  <i class="fas fa-flask " style="color:#00BCD4"> </i>
Vagrant and Sense HAT
                </a>
              </li>
            
          
            
              <li>
                <a class="item" href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//unit-1/book-a/index.html">
  <i class="fas fa-flask " style="color:#00BCD4"> </i>
Linux Practice Exercises
                </a>
              </li>
            
          
            
              <li>
                <a class="item" href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//unit-2/book-a/index.html">
  <i class="fas fa-flask " style="color:#00BCD4"> </i>
Home Network
                </a>
              </li>
            
          
            
              <li>
                <a class="item" href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//unit-1/book-a/index.html">
  <i class="fas fa-flask " style="color:#00BCD4"> </i>
Scripting Exercises
                </a>
              </li>
            
          
            
              <li>
                <a class="item" href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//unit-2/book-1-vagrant/index.html">
  <i class="fas fa-flask " style="color:#00BCD4"> </i>
Vagrant and Virtualisation
                </a>
              </li>
            
          
            
              <li>
                <a class="item" href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//unit-1/book-a/index.html">
  <i class="fas fa-flask " style="color:#00BCD4"> </i>
CPU
                </a>
              </li>
            
          
            
              <li>
                <a class="item" href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//unit-2/book-1-packet-sniffing/index.html">
  <i class="fas fa-flask " style="color:#00BCD4"> </i>
Packet Sniffing using TShark
                </a>
              </li>
            
          
            
              <li>
                <a class="item" href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//unit-1/book-a/index.html">
  <i class="fas fa-flask " style="color:#00BCD4"> </i>
Labs
                </a>
              </li>
            
          
            
              <li>
                <a class="item" href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//unit-2/book-1-IP-Networking/index.html">
  <i class="fas fa-flask " style="color:#00BCD4"> </i>
IP Networking
                </a>
              </li>
            
          
            
              <li>
                <a class="item" href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//unit-1/book-a/index.html">
  <i class="fas fa-flask " style="color:#00BCD4"> </i>
Labs
                </a>
              </li>
            
          
            
              <li>
                <a class="item" href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//unit-2/book-a/index.html">
  <i class="fas fa-flask " style="color:#00BCD4"> </i>
The Headless RPi
                </a>
              </li>
            
          
        </ul>
      </div>
    </div>
  </div>


    <div uk-sticky>
      <nav class="uk-navbar">
        <div class="uk-navbar-left">
          <ul class="uk-subnav uk-background-secondary uk-subnav-pill">
            <li><a href="#offcanvas-usage" uk-icon="icon: menu" , uk-toggle title="Switch Lab" pos="bottom"
                   uk-tooltip></a></li>
             }}
              <li class="uk-active"><a href="../../index.html" uk-icon="icon: chevron-up" uk-toggle title="Parent Topic"
                                       pos="bottom" uk-tooltip> Raspberry Pi </a></li>
            
          </ul>
        </div>
        <div class="uk-navbar-right">
          <ul class="uk-subnav uk-background-secondary uk-subnav-pill"
              uk-switcher="connect: .switcher-container">
            
              <li><a href="#">The Headless RPi</a></li>
            
              <li><a href="#">01</a></li>
            
              <li><a href="#">02</a></li>
            
              <li><a href="#">03</a></li>
            
              <li><a href="#">04</a></li>
            
              <li><a href="#">05</a></li>
            
              <li><a href="#">06</a></li>
            
          </ul>
        </div>
      </nav>
    </div>

    <div class="uk-container uk-container-expand">
      <ul class="uk-switcher switcher-container">
        
          <li> <h1>The Headless Pi</h1>
<p>Raspbian . SSH . WiFi</p>
<h2>Introduction</h2>
<p>The Raspberry Pi is a single board computer(SBC) which was designed to make tech learning easier but has since become popular in Internet of Things/Maker/Hacker community. It&#39;s got all the usual components you would expect on a typical personal computer such HDMI port, USB ports, an ethernet port, an SD card slot, Wi-Fi, Bluetooth etc.</p>
<p>It does not come with the usual peripherals such as cables, keyboard, mouse, or a monitor and you don&#39;t need them!. In this lab you will set up the the Raspberry Pi for <em>&quot;headless&quot;</em> use using a WiFi network.</p>
<h2>Equipment</h2>
<ul>
<li>Raspberry Pi 3</li>
<li>microSD Card</li>
<li>Computer with an SD card reader</li>
<li>SenseHAT</li>
<li>A WiFi network</li>
</ul>
<h2>Software</h2>
<ul>
<li>Text editor </li>
<li>Laptop/Computer with Node.js</li>
</ul>
<h2>Objectives</h2>
<ul>
<li>install Raspbian OS on SD card</li>
<li>Configure Raspberry Pi for SSH</li>
<li>Configure networking on Raspbian/Raspberry Pi</li>
<li>Find a Raspberry Pi on a network</li>
<li>Use SSH to connect to the Pi</li>
</ul>
</li>
        
          <li> <h1>Raspbian</h1>
<p><img src="./img/raspbian_logo.png" alt="Raspbian Logo"><br><strong>NOTE: Your Pi may have come with an SD card preloaded with Raspbian. In this case you can proceed to the next step/page in the lab.</strong><br><a href="https://www.raspbian.org/RaspbianAbout">Raspbian</a> is a Linux operating system designed and optimised specifically for the Raspberry Pi. It is a version of the Debian Linux operating system and has the same heratige as Ubuntu.<br>In this section of the lab you will download and install Raspbian on a SD card.</p>
<h2>Installing Raspbian</h2>
<p>This and future labs were developed using the minimal version of Raspbian Stretch Lite. If you intend to use your Pi with a Screen/Desktop at any stage then opt for the Desktop version.</p>
<p>Download Raspbian zip archive from <a href="https://www.raspberrypi.org/downloads/raspbian/">Raspberry Pi website Downloads page</a></p>
<p>Extract the raspbian image using a suitable unzip tool that supports ZIP64. The following zip tools support ZIP64. If you dont have one already, the following should work:</p>
<p><a href="https://www.7-zip.org/download.html">7-Zip (Windows)</a><br><a href="https://theunarchiver.com/">The Unarchiver (Mac)</a><br><a href="http://infozip.sourceforge.net/Info-ZIP.html">Unzip (Linux)</a></p>
<h3>Write the image to SD card</h3>
<p>There are several &quot;image burners&quot; available online. <a href="https://etcher.io/">Etcher</a> is a straight-forward image burner writer that will work for Windows/Mac/Linux.<br>Download and install <a href="https://etcher.io/">Etcher</a> for your operating system and do the following:<br>- Put your SD card into the reader on your computer. 
- Open Etcher and select the Raspberry Pi .img file you wish to write to the SD card.
- Select the SD card you wish to write your image to.
- click &#39;Flash!&#39; to begin writing data to the SD card.  </p>
<p>The write may take a few minutes. Once it&#39;s finished, close Etcher and leave the SD card in the drive for now. 
<img src="./img/etcher.gif" alt="Etcher"></p>
</li>
        
          <li> <h1>Raspbian Configuration</h1>
<p>To use the Pi in headless mode, you will need to make some changes on the the SD card before we put it into the Pi and boot up. </p>
<h2>Editing the SD card contents</h2>
<p>The SD card is just like any other drive on your computer. You should be able to locate it using the default file explorer on your computer or navigate to it using a command line terminal. You will see at least one partition, possibly two depending on what OS is on your computer. What we are after at the moment is the <strong>boot</strong> partition which should be visible on all operating systems. It should be labeled as such in your file explorer if you are using a Mac or Linux machine. If you&#39;re using Windows, it will be the only accessible part of the SD card. </p>
<h2>Enable SSH access</h2>
<ul>
<li>Place an empty file named <code>ssh</code>, without any extension, onto the boot partition of the SD card. If you&#39;re using Windows, inside the boot directory, right-click in the white space, scroll to <code>New</code> and select <code>Text</code> Document. Enter <code>ssh</code> as the name.<br><strong>NOTE: You may see two partitions. The first one, which is the smaller one, is the boot partition. Place the file into this one.</strong></li>
</ul>
<h2>Configure Wifi connection</h2>
<h3>On Mac/Linux</h3>
<ul>
<li>Create a new file in the <code>boot</code> drive called <code>wpa_supplicant.conf</code>.
Follow code step below.</li>
</ul>
<h3>On Windows</h3>
<ul>
<li>Download and install Notepad++ from <a href="https://notepad-plus-plus.org/download">here</a>.</li>
<li>Once installed, inside Notepad++ go to <code>File &gt; New</code> to create a new file.</li>
<li>In the top bar, select <code>Edit &gt; EOL Conversion</code>. Make sure <code>Unix (LF)</code> is selected. It should appear disabled if it is.</li>
<li>Select <code>File &gt; Save as</code>, navigate to your <code>boot</code> drive and call the file <code>wpa_supplicant.conf</code>.</li>
</ul>
<h2>Enter Wifi Details</h2>
<p>Enter the following into <code>wpa_supplicant.conf</code>.</p>
<pre><code class="lang-bash">country=IE
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1

network={
scan_ssid=1
ssid=&quot;Your-SSID&quot;
psk=&quot;Your-PSK&quot;
key_mgmt=WPA-PSK
}</code></pre>
<p>Replace <code>Your-SSID</code> with your WiFi network, and <code>Your-PSK</code> with your WiFi password.
This file will tell the Raspberry Pi to connect to the specified network when it boots up.
The wifi network paramaters here are typical for most domestic WiFi. If you&#39;re having problems connectingin the next section, examining how your computer connects to the WiFi. For example, <code>key_mgmt</code> could be either <code>WPA-PSK</code> (most probably) or <code>WPA-EAP</code> (enterprise networks).</p>
<p>When complete, your boot patition on the SDCard should contain the following:
<img src="./img/boot.png" alt="boot partition"></p>
<h2>Boot the Pi</h2>
<ul>
<li>Eject the SD card and put it into the unplugged RPi. </li>
<li>Now power up the RPi - it should automatically connect to the the WiFi network. But how do you know if it&#39;s connected? You&#39;ll have to find it on the local network...</li>
</ul>
<h2>Exercise</h2>
<p>Before moving on, try to come up with your own solution to finding and connecting to the RPi. If everything has worked out so far you now know the following: 
+ default host name is &quot;raspberrypi&quot;
+ the RPi should have acquired an IP address on the same local network as your computer (<strong>Make sure your computer is connected to the same network as your RPi!</strong>)
+ It&#39;s configured for SSH
+ All RPis have the same manufacturers MAC address section, so the MAC will start with &quot;<code>b8:27:eb:...</code>&quot;  </p>
<p>There is more than one solution to this problem. See if you can come up with more than one before moving on...</p>
</li>
        
          <li> <h1>Where&#39;s my RPi?</h1>
<p>So to use the RPi in headless mode, you will need to find its IP address. To do this, we&#39;ll use the fact that we know the host name and the MAC address pattern. Here are a few solutions you can try(you need only pick one):</p>
<h2>1. Use ARP</h2>
<p>From the web, and the previous page, you know that the first 3 bytes of the MAC address indicates the manufacturer/source of the device. In this case, for the Pi it will be <code>b8:27:eb:...</code>.<br>So one thing you can do is build up the arp cache on your computer by pinging every possible IP address on your network. If we do this, then the ARP table on your machine should contain the RPi MAC. We can use a small Node script to do this.<br>- Create a directory on your laptop called LAB_NAME. Open a terminal window and install the following node package:</p>
<pre><code class="lang-bash">npm install local-devices</code></pre>
<p>In the same directory, create a new file called <code>index.js</code> with the following code:</p>
<pre><code class="lang-javascript">const find = require(&#39;local-devices&#39;)

// Find all Raspberry Pi devices
find().then(devices =&gt; {
  const aPi = x =&gt; x.mac.startsWith(&#39;b8:27:eb:&#39;)
  console.log(devices.filter(aPi)); 
})</code></pre>
<p>Run the script from a terminal window by typing <code>node index.js</code> at the command prompt. You should something similar to the following:</p>
<pre><code class="lang-bash">[ { name: &#39;raspberrypi&#39;,
    ip: &#39;192.168.1.81&#39;,
    mac: &#39;b8:27:eb:34:93:c6 [ether]&#39; } ]</code></pre>
<h2>2. Use the router</h2>
<p>If you have administrator rights to your home router and can access the router management page then there usually is a facility to list all connected devices, including their host name and MAC address. As there are many home routers out there, how you access the network connection data will differ in each case.</p>
<h2>3. Use Adafruit Pi Finder</h2>
<p><a href="https://learn.adafruit.com/the-adafruit-raspberry-pi-finder/overview">Adafruit</a> Pi Finder is a cross-platform tool that allows you to find and connect to a Raspberry Pi that is attached to your network.
You can download the version for your particular OS here: <a href="https://github.com/adafruit/Adafruit-Pi-Finder/releases/tag/3.0.0">https://github.com/adafruit/Adafruit-Pi-Finder/releases/tag/3.0.0</a><br><img src="./img/pi-finder1.png" alt="Pi Finder"></p>
</li>
        
          <li> <h1>Accessing the RPi using Secure Shell(SSH)</h1>
<p>In order to access the RPi using SSH you should have the following completed:
- Enabled SSH by placing an ssh file in the boot partition
- You know the IP address of your Raspberry Pi.  </p>
<h2>SSH Client</h2>
<p>SSH is built into Linux and Mac OSX. For Windows you will need to get a suitable 3rd party client. Please follow the instructions for your particular OS:</p>
<h3>SSH from Windows</h3>
<p>A popular SSH client for windows is called PuTTY.  Download and install the relevant windows installer from  <a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html">here</a>. </p>
<p>Run PuTTY and type the IP address of your RPi into the Host Name field and click the Open button.<br><img src="./img/putty1.png" alt="PuTTY">  </p>
<p>When the connection works you will see the security warning shown below. Click the &#39;Yes&#39; button. You will only see this warning the first time PuTTY connects to a RPi.<br><img src="./img/putty2.png" alt="PuTTY"> </p>
<p>You will now see the login prompt. The default login for Raspbian is <code>pi</code> with the password <code>raspberry</code>.</p>
<p>You should now have the Raspberry Pi prompt:</p>
<pre><code class="lang-bash">pi@raspberrypi ~ $</code></pre>
<p>You are now connected to the Pi remotely, and can execute commands.</p>
<h3>SSH from MAC/Linux</h3>
<p>To connect to your Pi from Linux or MAC OSX, enter the following command into a terminal and replace <IP> with the IP address of the RPi. </p>
<pre><code class="lang-bash">ssh pi@&lt;IP&gt;</code></pre>
<p>If you receive a connection timed out error it is likely that you have entered the wrong IP address for the Raspberry Pi.</p>
<p>When the connection works you will see a security/authenticity warning. Type  yes to continue. You will only see this warning the first time you connect.</p>
<p>You may be given a warning and asked to clear the record from your list of known devices. Accept this instruction and trying the ssh command again should be successful.</p>
<p>Next you will be prompted for the password for the pi login: the default password on Raspbian is raspberry. </p>
<p>You should now have the Raspberry Pi prompt:</p>
<pre><code class="lang-bash">pi@raspberrypi ~ $</code></pre>
<p>You are now connected to the Pi remotely, and can execute commands.</p>
<h2>Connection Problems</h2>
<p>A connection might be unsuccessful for various reasons. If you get a network connection error or connection time out, check that you have the correct IP address for the RPi by pinging it. If the ping replies successfully then it may be the case that you have not enabled SSH on the RPi. Power down the RPi and repeat the Enable SSH section in the Raspbian Configuration page of this lab. </p>
<p> Also, remeber that the the IP address of the RPi can change if it uses Dynamic Host Configuration Protocol(DHCP). You will need to find and update the IP address if this happens. </p>
<h2>Ongoing use of Putty</h2>
<p>Next time you use PuTTY, look for the Saved Sessions section in the bottom half of the configuration screen. If you use this, it is recommended to switch to the  Connection page in the left hand tree, and setting the  Seconds between keepalives value to 30. Then switch back to the  Session page in the tree before you click Save. Using this setting allows you to leave a PuTTY window open for long periods of time with no activity, without the Pi timing out and disconnecting you.</p>
<p>A connection might be unsuccessful for various reasons. It is most likely that your device or Raspberry Pi are not connected properly; SSH is disabled; there is a typo in your code; or the IP address or credentials have changed. In the latter cases, you will need to update the host. For instructions on how to update a host, and for further PuTTY documentation, please see the PuTTY docs.</p>
</li>
        
          <li> <h1>Raspi-Config</h1>
<p>Now that you have connected to the RPi you can use the <code>raspi-config</code> utility to further configure the RPi.</p>
<p>At the command prompt in the the RPi SSH session, enter <code>sudo raspi-config</code>. This will show the following:<br><img src="./img/rpi-config.png" alt="raspi-config">   </p>
<h3>Change Password</h3>
<p>It&#39;s probably not a good idea to let your RPi hang around on a network with the default username and password.
Select the <code>Change User Password</code> option and change the password now.</p>
<h3>Expand rootfs</h3>
<p>Typically, Raspbian images are 2 GB. When you copy the image to a larger SD card then a large portion of the  card may be left unused. To make this available to Raspbian, and the apps installed on the RPi, you can expand it to  fill the rest of the SD card.<br>In the Raspi-config tool, select Advanced Options-&gt;Expand Filesystem
<img src="./img/expand-filesystem1.png" alt="Expand rootfs Partition"><br>You should be informed that the resize will take place on the next reboot of the RPi.</p>
<h3>Host Name</h3>
<p>Your RPi will have the default host name of <code>raspberrypi</code>. It would be good to rename this to something more meaningfull. I
In the Raspi-config tool, select Network Options-&gt;Hostname
<img src="./img/hostname.png" alt="Change Hostname"><br>Change the Hostname to <code>sensePi</code>(or, if you want, whatever name you like!). This is the name that the RPi will use on the local network.</p>
</li>
        
          <li> <h1>SenseHAT</h1>
<p>Assuming you have the SenseHAT installed on your RPi, lets run the same program we used in the on-site lab. </p>
<ul>
<li>SSH into you Raspberry Pi. You can probably use the host name you configured in the last step instead of the IP address.</li>
</ul>
<h2>Install Sense HAT</h2>
<ul>
<li>Type this command into the terminal to install the Sense HAT package:</li>
</ul>
<pre><code class="lang-bash">sudo apt-get install sense-hat</code></pre>
<h2>Create Python Program</h2>
<ul>
<li>Create a new directory called <code>cs-lab-5</code> and change directory to it:<pre><code class="lang-bash">~ $ mkdir cs-lab-5
~ $ cd cs-lab-5
~/cs-lab-5 $</code></pre>
</li>
<li>Using nano, create a new python script called <code>temp-sensor.py</code> and add the following code:
```python
from sense_hat import SenseHat</li>
</ul>
<p>sense = SenseHat()
sense.clear()
green = (0, 255, 0)
red = (255,0,0)
while True:
  temp = sense.get_temperature()
  if temp &gt;=25:
    sense.show_message(&quot;HOT!&quot;, text_colour = red)
  else:
    sense.show_message(&quot;Fine!&quot;, text_colour = green)
  print(temp)</p>
<p><code>`
- Now run the the program by typing</code>python temp-sensor.py`` at the command line. You should see output similar to the following:</p>
<pre><code class="lang-bash">~/cs-lab-5 $ python temp-sensor.py
33.149307251
33.1675720215
33.2771759033
33.3319740295</code></pre>
<p>and your SenseHAT should be telling you if it&#39;s HOT! or Fine.</p>
<p>Look at the code and try to understand the logic using what you learned in Programming. Some things of note with Python
1. You use indent group statements in a program or script. For example, notice the  block of code contained in the <code>while</code> statement is indented.
2. You don&#39;t have to compile it before you run it - it&#39;s an &#39;interpreted&#39; language.
3. Python is dynamically typed; you don&#39;t have to declare what type each variable is.  </p>
<ul>
<li>Change the above code and set the temperature threshold so that it changes the output on the SenseHAT(i.e. if it&#39;s <code>HOT!</code>, make it display <code>Fine</code>).</li>
<li>Notice how <code>red</code> and <code>green</code> variables are structured. Investigate and explain why.</li>
<li>Change the program to display everything in blue. </li>
</ul>
</li>
        
      </ul>
    </div>

    <script>
      $(document).ready(function() {
  const $images = $('.lab img');
  jQuery.each($images, function(i) {
    if ($images[i].alt.length > 0) {
      const divImg = $(document.createElement('div')).addClass('');
      $($images[i]).wrap(divImg);
      const divLabel = $(document.createElement('div')).addClass('uk-label uk-text-lowercase');
      divLabel.append($images[i].alt);
      $(divLabel).insertAfter($images[i]);
      $('<br>').insertAfter($images[i]);
    }
  });
});

    </script>
  </body>
</html>