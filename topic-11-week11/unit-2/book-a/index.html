<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.css"
          type="text/css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/railscasts.min.css"
          rel="stylesheet"/>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/jquery.address/1.6/jquery.address.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/java.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/kotlin.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <style>
      

body {
  font-family: "Open Sans", "Helvetica", "Helvetica Neue",  "Arial", sans-serif;
  font-size:90%;
  color: black;
}

p {
  margin: 0.5em;
}

pre code {
  font-family: "Monaco";
  font-size: 100%;
}

img {
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
  margin:10px;
}

h1, h2, h3 {
  border-bottom:thin solid black;
  margin-bottom: 0.5em;
  margin-top: 1em;
}

h1 {
  font-style:italic;
  font-size:130%;
}

h2 {
  font-size:110%;
}

h3 {
  font-size:100%;
}



      

html, body {
  height: 100%;
  margin: 0;
}
.wrapper {
  height: 100%;
  display: flex;
  flex-direction: column;
}
.footer {
  background: white;
  text-align: right;
}
.content {
  flex: 1;
  overflow: auto;
}



    </style>
  </head>

  
  

  <div class="ui fixed top pointing inverted stackable menu labmenu">
    <header class="header item">
      <i id="toc" class="sitemap icon"></i>
      
        <a href="../../index.html">  IoT Mobile Apps  </a>
      
    </header>
    <div class="right tab-menu menu">
      
        <a class="item" data-tab="Blynk">
          Blynk
        </a>
      
        <a class="item" data-tab="01">
          01
        </a>
      
        <a class="item" data-tab="02">
          02
        </a>
      
        <a class="item" data-tab="03">
          03
        </a>
      
    </div>
  </div>


  

  <div class="ui pushable">
    <div class="ui inverted labeled icon left inline vertical sidebar menu">
      <br><br>
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-00-open-day/book-1/index.html">Preparatory Lab </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-00-open-day/book-2/index.html">Shell Scripting </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-00-open-day/book-3/index.html">Vagrant and Sense HAT </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-000-LinuxAssessment/book-a/index.html">Assessment-Guides </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-01-week1/unit-1/book-a/index.html">Linux Practice Exercises </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-01-week1/unit-2/book-a/index.html">Home Network </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-02-week2/unit-1/book-a/index.html">Scripting Exercises </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-02-week2/unit-2/book-1-vagrant/index.html">Vagrant and Virtualisation </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-03-week3/unit-1/book-a/index.html">cpu </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-03-week3/unit-2/book-1-packet-sniffing/index.html">Packet Sniffing using TShark </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-04-week4/unit-1/book-a/index.html">NoBases </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-04-week4/unit-2/book-1-IP-Networking/index.html">IP Networking </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-05-week5/unit-1/book-a/index.html">Boolean </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-05-week5/unit-2/book-a/index.html">The Headless RPi </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-06-week6/unit-1/book-a/index.html">Logic </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-06-week6/unit-2/book-a/index.html">Presence Detector 1 </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-06-week6/unit-2/book-b/index.html">BLE </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-07-week7/unit-2/book-a/index.html">TCP-Sockets </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-08-week8/unit-1/book-a/index.html">Lab </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-08-week8/unit-2/book-a/index.html">Messaging Lab </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-09-week9/unit-1/book-a/index.html">Labs </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-09-week9/unit-2/book-a/index.html">Wia Lab </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-10-week10/unit-1/book-a/index.html">Labs </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-11-week11/unit-1/book-a/index.html">Labs </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2018.github.io/computer-systems//topic-11-week11/unit-2/book-a/index.html">Blynk </a>
          
        
      
    </div>
    <div class="pusher" tabindex="-1">
      <div class="ui basic segment">
        <br>
        
          <div class="ui tab segment lab" data-tab="Blynk">
            <h1>IoT Mobile Apps using Blynk</h1>
<p>Remote Hardware Control via Mobile App.</p>
<p>Blynk was designed for the Internet of Things. It can control hardware remotely, it can display sensor data, it can store and visualise data. </p>
<p><img src="./img/main.png" alt="Blynk"></p>
<p>In this lab you will:</p>
<ul>
<li>Use the Blynk app to control a Raspberry Pi</li>
<li>Access your Phone sensors (light and GPS)</li>
<li>Send data to 3rd party service (Thingspeak)</li>
<li>Send your Phone location to Wia. </li>
</ul>

          </div>
        
          <div class="ui tab segment lab" data-tab="01">
            <h2>Install the Blynk App</h2>
<p>You will need the Blynk app on an Android or IoS device such as a Smart Phone or Tablet. If you don&#39;t have a device available to do this, you can <a href="https://community.blynk.cc/t/blynk-desktop-app-android-emulator/13968">emulate Android on your desktop</a>.</p>
<ul>
<li><p>Install the Blynk App for your Smartphone (or Tablet) from <a href="https://www.blynk.cc/getting-started/">here</a>.</p>
</li>
<li><p>Use the App to do the following:</p>
</li>
<li>Create a new account in Blynk App.</li>
<li>Create a New Project with the following details:<ul>
<li>Name: Blynk-lab1</li>
<li>Choose <code>Raspberry Pi 3</code> as the board and the type of network connection you use with the RPi (either Wifi or Ethernet).</li>
</ul>
</li>
<li>After the project is created, You will see your empty app. We will add controls to it later. In the mean time, retrieve your project Auth Token in your email (check your junk folder if you can&#39;t find it).</li>
</ul>
<p><img src="./img/blynk3.png" alt="Blynk - Blank App"></p>
<h2>Install Blynk Library on the Raspberry Pi</h2>
<p>We will use <code>Node</code> Blynk library to control the RPi.</p>
<ul>
<li>Check if Node is already on the pi. If so,you are adviced to remove it and reinstall as follows:</li>
</ul>
<p>(<strong>BTW:</strong> If node is already installed and you don&#39;t want to remove it, you can try to proceed to the next step and see if it works...)</p>
<pre><code class="lang-bash">sudo apt-get purge node nodejs node.js -y
sudo apt-get autoremove</code></pre>
<ul>
<li>Update package repository and install node </li>
</ul>
<pre><code class="lang-bash">curl -sL &quot;https://deb.nodesource.com/setup_6.x&quot; | sudo -E bash -
sudo apt-get install build-essential nodejs -y
sudo apt-get install npm</code></pre>
<h2>Create your Blynk App</h2>
<ul>
<li>Make a new directory for your Blynk project</li>
</ul>
<pre><code class="lang-bash">mkdir blynk-lab</code></pre>
<ul>
<li>In that directory,  initialise a new Node project:</li>
</ul>
<pre><code class="lang-bash">npm init</code></pre>
<p>You will be asked a few questions. Fill them in as you see fit - if you are unsure of any lust hit <code>enter</code> to use the default value.</p>
<ul>
<li>Install the Blynk dependencies</li>
</ul>
<pre><code class="lang-bash">sudo npm install blynk-library --save
sudo npm install onoff ---save</code></pre>
<ul>
<li>In the <code>blynk-lab</code> directory, create a new file called <code>index.js</code> with the following content:</li>
</ul>
<pre><code class="lang-JavaScript">var Blynk = require(&quot;blynk-library&quot;);

var AUTH = &#39;YOUR-AUTH-TOKEN&#39;;

var blynk = new Blynk.Blynk(AUTH);

var v1 = new blynk.VirtualPin(1);

v1.on(&#39;write&#39;, function(param) {
  console.log(&#39;V1:&#39;, param[0]);
});</code></pre>
<p>The above script creates a <code>Virtual Pin</code> on your Raspberry Pi. You can use this to interface, display and send data with your Blynk app on your phone.</p>
<ul>
<li>Run the script by entering <code>node index.js</code> at the command line. You should see the following output:</li>
</ul>
<p><img src="./img/blynk1.png" alt="Blynk Node connection"></p>
<p>Leave the app running on the RPi for the following section.</p>
<h2>Send commands to the RPi From your phone app</h2>
<p>So now lets send commands from your phone to the Raspberry Pi. Open <code>Blynk-lab1</code> project on your mobile device and do the following</p>
<ul>
<li>Click on the <code>+</code> icon in the menu to open the <code>Widget box</code></li>
</ul>
<p><img src="./img/blynk4.png" alt="Blynk - Button"></p>
<ul>
<li>Select the <code>Button</code> and it should appear on your project</li>
</ul>
<ul>
<li>Double tap the button and apply the following settings<ul>
<li>name it <code>Light</code></li>
<li>In the Output section, select <code>PIN</code> and change it to <code>Virtual V1</code></li>
<li>Chane the Mode to <code>Switch</code></li>
</ul>
</li>
</ul>
<p><img src="./img/blynk5.png" alt="Blynk - Button"></p>
<ul>
<li><p>Now hit the back arrow to return to the Project.</p>
</li>
<li><p>Click the <code>Run</code> Button to start the app on the phone.</p>
</li>
<li>Click on the <code>Light</code> button a few times, it will toggle between on and off.</li>
<li>Examine the output on the RPi console, you should see the following:</li>
</ul>
<p><img src="./img/blynk2.png" alt="Blynk on/off button"></p>
<p>You&#39;re now controlling tshe virtual pin from your phone from anywhere via the internet. To confirm this, you can turn off the Wifi on your phone and use the 3G/4G data from your phone network - it should still work.</p>
<p>Next let&#39;s hook up the SenseHat to the virtual pin.</p>
<ul>
<li>Stop your Blynk app on the RPi by entering <code>ctrl-c</code> at the command line.</li>
<li>Install the <code>node-sense-hat</code> module to your project</li>
</ul>
<pre><code class="lang-bash">npm install node-sense-hat --save</code></pre>
<ul>
<li>Now replace the code in <code>index.js</code> to the following:</li>
</ul>
<pre><code class="lang-javascript">var Blynk = require(&quot;blynk-library&quot;);

var sense = require(&quot;node-sense-hat&quot;);

var AUTH = &#39;YOUR-AUTH-CODE&#39;;

var blynk = new Blynk.Blynk(AUTH);

var v1 = new blynk.VirtualPin(1);

var white = [255, 255, 255];
sense.Leds.clear();

// v1 write call back
v1.on(&#39;write&#39;, function(param) {
  console.log(&#39;V1:&#39;, param[0]);
  if (param[0]==1){
        sense.Leds.clear(white)
    }else{
        sense.Leds.clear();
    }
});</code></pre>
<p>The updated code now includes the following; initialises the SenseHat with <code>sense.Leds.clear()</code> and sets the LEDs to <code>white</code> when the virtual pin, <code>v1</code>, is set to 1. Every time the button is pressed in the phone app results in the callback function for the <code>write</code> event to execute. Compare this to how you handled Python callbacks in the MQTT lab.</p>
<h2>Use the ZeRGBa</h2>
<p>Lets replace the button with a more interactive way of conrolling the LED matrix.</p>
<ul>
<li>Stop the Blynk app on the phone and delete the button by double tapping, scrolling down and selecting the <code>Delete</code> option.</li>
<li>Now, as before, open the <code>Widget Box</code> and add the <code>zeRGBra</code> widget. Your app should look like this:</li>
</ul>
<p><img src="./img/zergbra.png" alt="zeRGBra"></p>
<ul>
<li>Double tab the zeRGBra widget and configure as follows:</li>
</ul>
<p><img src="./img/zergbra2.png" alt="zeRGBra"></p>
<ul>
<li>Now, in <code>index.js</code> on the RPi, replace the <code>v1.on(&#39;write&#39;...</code> call back with the following code:</li>
</ul>
<pre><code class="lang-javascript">// v1 write call back
v1.on(&#39;write&#39;, function(param) {
     var colour = param.map(Number);
     sense.Leds.clear(colour);
});</code></pre>
<p>The above write callback converts the array of rgb values written by the zeRGBra widget to numeric(integers) and passes the values to the sensehat leds.</p>
<ul>
<li>Run the app again. You should now be able to set the colour of the LEDs using the zeRGBra.</li>
</ul>
<h2>Get data from the RPi to your phone</h2>
<ul>
<li><p>Stop the app on your phone by clicking on the <code>Stop</code> icon button in the menu bar.</p>
</li>
<li><p>Click on the <code>+</code> icon in the menu to open the <code>Widget box</code> and add a <code>Value Display</code> widget.</p>
</li>
<li><p>Double tap on the <code>Value Display</code> widget and configure the widget to use virtual pin <code>V2</code> and read the temp value every 5 seconds as follows:</p>
</li>
</ul>
<p><img src="./img/temp.png" alt="Temp Value Settings"></p>
<ul>
<li>Now, on the Raspberry Pi, replace the code in <code>index.js</code> with the following code:</li>
</ul>
<pre><code class="lang-javascript">var Blynk = require(&quot;blynk-library&quot;);

var sense = require(&quot;node-sense-hat&quot;);
var imu = sense.Imu;
var IMU = new imu.IMU();

var AUTH = &#39;YOUR-AUTH-CODE&#39;;

var blynk = new Blynk.Blynk(AUTH);

var v1 = new blynk.VirtualPin(1);
var v2 = new blynk.VirtualPin(2);

var white = [255, 255, 255];
sense.Leds.clear();


// v1 write call back
v1.on(&#39;write&#39;, function(param) {
     var colour = param.map(Number);
     sense.Leds.clear(colour);
});

v2.on(&#39;read&#39;, function() {
  IMU.getValue(function (e, data) {
     v2.write(data.temperature);
  })
});</code></pre>
<p>The updated code &quot;listens&quot; for reads events on virtual pin <code>V2</code>, gets the SenseHAT temperature value, and returns the temperature value to pin <code>V2</code>.</p>
<ul>
<li>Now run the node app on the RPi as before using <code>node index.js</code>.</li>
<li>Run the <code>Blynk-lab1</code> app on your phone again by tapping the <code>Run</code> icon. It will now read the value of the virtual pin <code>V2</code> every 5 seconds and display the returned value.</li>
</ul>

          </div>
        
          <div class="ui tab segment lab" data-tab="02">
            <h1>Phone Sensors</h1>
<p><strong>NOTE: The following sections were tested using an Android Device (Alcatel A3). Blynk is designed to be cross platform but some variations in operation, particularly when integrating with phone sensors, may exist on different phone models. You can try this section on an emulated smartphone.</strong></p>
<p>Blynk has lots of widgets for various uses. The phone app also allow you to access the phones sensors such a light sensor, accelerometer. The next example will use use a <code>webhook</code> to push  light sensor data to Thingspeak for analysis.</p>
<ul>
<li>On your phone, stop the Blynk app if it&#39;s running.</li>
<li>As in previous steps, open the Widget Box and add the <code>Light Sensor</code> to your app (you&#39;ll need to scroll down to find it).</li>
<li><p>Double-tap on the light sensor widget to open the settings and configure as follows:</p>
<ul>
<li>Set the output pin to Virtual V3</li>
<li>Set the write interval to 1 second</li>
</ul>
</li>
<li><p>Run the Blynk app on your phone, you should see lux (light measurement) values for light intensity in the widget. </p>
</li>
<li>Now, on the RPi, we&#39;ll use the lux values to test if it&#39;s too dark (&lt;50 lux).</li>
<li>On the Raspberry Pi, stop the Blynk Node app and make the following changes to <code>index.js</code>:<ul>
<li>In the variable declarations add the <code>v3</code> variable and a variable to record the last button state</li>
</ul>
</li>
</ul>
<pre><code class="lang-javascript">var v3 = new blynk.VirtualPin(3);</code></pre>
<ul>
<li>add the following call back for <code>V3</code> at the end of <code>index.js</code> to handle Virtual Pin 3 (i.e. the one that&#39;s linked to the light sensor)</li>
</ul>
<pre><code class="lang-javascript">v3.on(&#39;write&#39;, function(param) {
  //check if it&#39;s too dark!
  if (param[0]&lt;50){console.log(&quot;It&#39;s a bit dark&quot;)}
  //You could do something interesting here like turn on lights!
});</code></pre>
<ul>
<li>Now run the Node app and the phone app. You should now be able to get the RPi to display the &quot;It&#39;s too dark&quot; message on the console by covering the light sensor on your phone with your hand. The threshold is set to 50 for switching on/off. Depending on your phone and sensor values you may need to adjust the threshold value (50) used in the code to make it work.</li>
</ul>
<h2>Sending Data to Thingspeak</h2>
<p>The Blynk Webhook widget allows you to communicate with 3rd party services. With Webhook widget you can send HTTP(S) requests to any 3rd party service or devices that has HTTP(S) API (e.g. other smart devices with a Web API, Thingspeak, Smart Lights). </p>
<h3>Thingspeak Temperature Channel</h3>
<ul>
<li><p>Go to Thingspeak and, if you haven&#39;t already, create a new channel for Temperature data. You can use one from previous labs if you want. (See last weeks lab/tutorial)</p>
</li>
<li><p>Retrieve your <code>Write API Key</code> for the channel you wish to use. </p>
</li>
</ul>
<h3>Blynk Phone App</h3>
<ul>
<li>On your phone, stop the Blynk app if it&#39;s running.</li>
<li>As in previous steps, open the Widget Box and add the <code>Webhook</code> widget to your app (you&#39;ll need to scroll down to find it).</li>
<li><p>For this part, we will want to monitor virtual pin <code>V2</code> and send the data to Thingspeak.</p>
</li>
<li><p>Double tap the Webhook widget and configure as shown below:</p>
</li>
</ul>
<p><img src="./img/webhook.png" alt="Webhook"></p>
<p><strong>The URL field should be filled in as follows:</strong></p>
<pre><code>https://api.thingspeak.com/update?api_key=YOUR_API_WRITE_KEY&amp;field1=/pin/</code></pre>
<p>Now, every time there is a “write” command to V2 pin on the Raspberry Pi the Webhook will be triggered and write the value (in this case the temp) into the URL using the <code>/pin/</code> placeholder.
See <a href="https://docs.blynk.cc/#widgets-other-webhook">here</a> for more details</p>
<ul>
<li>Now run your Phone app and Node app again. You should see temperature data appear in thingspeak (and you didn&#39;t even have to write any code!_)</li>
</ul>
<p><img src="./img/thing.png" alt="Thingspeak Data"></p>

          </div>
        
          <div class="ui tab segment lab" data-tab="03">
            <h2>Location/GPS Streaming</h2>
<p>In this section we will use Blynk&#39;s GPS streaming feature to push the phone location to Wia.
As we&#39;re working with Javascript, you&#39;ll need to install the Wia node module. Run the following command in your project directory.</p>
<pre><code>npm install wia --save</code></pre>
<h2>Add the GPS Widget</h2>
<ul>
<li>If running, stop the Blynk app on you phone.<ul>
<li><strong>You will need to delete a widget to complete this section if you wish to remain in the &quot;free tier&quot;. Delete the <code>light sensor</code> widget. This will give you enough energy for the GPS widget!</strong></li>
</ul>
</li>
<li>Open the <code>Widget Box</code> abd add the <code>GPS widget</code></li>
<li>Configure as follows, making sure to select <code>V4</code> as the output.</li>
</ul>
<p><img src="./img/gpswidget.png" alt="GPS Widget"></p>
<h2>Creating your Location Tracking Device</h2>
<ul>
<li>Go to the Wia dashboard and select Devices.</li>
<li>From here, click on the <code>+</code> symbol and the <code>Add New Device</code> wuindow will appear.</li>
<li><p>Enter &#39;Location Device&#39; as the name and click Add Device.</p>
<p><img src="./img/adddevice.png" alt="Add Device"></p>
</li>
<li><p>Click on View device to go to the device&#39;s overview page. Take a note of the device&#39;s secret key, you&#39;ll need this later.</p>
</li>
</ul>
<h2>Update index.js</h2>
<ul>
<li><p>If running, Stop the RPi Node app.</p>
</li>
<li><p>Open <code>index.js</code> in an editor and add the following line of code to the top of the file. Replace the device-secret-key on with your device&#39;s <code>secret key</code>.</p>
</li>
</ul>
<pre><code class="lang-javascript">var wia = require(&#39;wia&#39;)(&#39;YOUR-DEVICE-SECRET-KEY&#39;);</code></pre>
<ul>
<li>At the end of the script, add the following code to handle the GPS data write event from the device and send it to <code>Wia</code> using MQTT.</li>
</ul>
<pre><code class="lang-javascript">v4.on(&#39;write&#39;, function(param) {
 console.log(&quot;v4: lat. &quot; + param[0])
 wia.locations.publish({
  latitude: param[0],
  longitude: param[1]
});
});

wia.stream.connect();</code></pre>
<ul>
<li><p>Now run both the RPi Node app and the Phone App. Make sure the location/GPS is switched on. </p>
</li>
<li><p>Open Wia in a browser and go to the Locations tab for your device. You should start to see your location appear in the Wia platform.</p>
</li>
</ul>
<p><img src="./img/locations.png" alt="Wia Locations"></p>
<ul>
<li>Click on the <code>Overview</code> tab in add a Map widget by clicking the <code>Add a Widget</code> button. </li>
</ul>
<p><img src="./img/location2.png" alt="Add Location Widget"></p>
<ul>
<li>Give it a name &quot;Locaton&quot; and you should now see your device location, sent from the Blynk app.</li>
</ul>
<p><img src="./img/map.png" alt="Add Location Widget"></p>

          </div>
        
      </div>
    </div>
  </div>



  <script>
    $(document).on('keydown', function(e) {
  e = e || window.event;
  var nextTab;
  switch (e.which || e.keyCode) {
    case 37: // left
      nextTab = $('.tab-menu a[data-tab].active').prev('a[data-tab]');
      if (!nextTab.length) nextTab = $('.tab-menu a[data-tab]').last();
      nextTab.click();
      $('.pusher').focus();
      break;

    case 39: // right
      nextTab = $('.tab-menu a[data-tab].active').next('a[data-tab]');
      if (!nextTab.length) nextTab = $('.tab-menu a[data-tab]').first();
      nextTab.click();
      $('.pusher').focus();
      break;
  }
});

    $(document).ready(function() {
  $('img').addClass('ui image');

  $('.ui.embed').embed();

  const $images = $('.lab img');
  jQuery.each($images, function(i) {
    if ($images[i].alt.length > 0) {
      const divImg = $(document.createElement('div')).addClass(
        'ui basic segment',
      );
      $($images[i]).wrap(divImg);
      const divLabel = $(document.createElement('div')).addClass(
        'ui blue ribbon label',
      );
      divLabel.append($images[i].alt);
      $(divLabel).insertBefore($images[i]);
    }
  });

  $('.ui.menu .item').tab({
    history: true,
    historyType: 'hash',
  });

  $('.popup').popup();

  $('.ui.sidebar')
    .sidebar({ context: $('.pushable') })
    .sidebar('setting', 'transition', 'slide out')
    .sidebar('attach events', '#toc');
});

  </script>



  <div class="ui bottom fixed borderless right menu">
    <div class="ui right small menu">
      <div class="ui tiny basic message segment">
         Powered by <a href="https://github.com/edeleastar/tutors-ts">tutors-ts.</a> Unless otherwise stated, this work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
      </div>
    </div>
  </div>

  </body>

</html>